pipeline {
    agent any
    environment {
        imageName = "workstation"
        registryCredentials = "nexus"
        registry = "lab.jithendar.com:8085"
        dockerImage = ''
        COMPONENT = "workstation"
        TAG = "10.0"
    }

    parameters {
    choice(name: 'Workstation', choices: ['Build & Push Image', 'Create POD'], description: 'Pick any action')
               }
    stages {
        
        stage ('Build Docker Image') {
            when {expression {params.Workstation == 'Build & Push Image'}}
            steps {
                script {
                    dockerImage = docker.build "${registry}/${COMPONENT}:${TAG}"
                }
                }
                }
        stage ('Push Docker Image') {
            when {expression {params.Workstation == 'Build & Push Image'}}
            steps {
                script {
                    withDockerRegistry(credentialsId: 'nexus', toolName: 'docker', url: 'lab.jithendar.com:8085') {
                    dockerImage = docker.push "${registry}/${COMPONENT}:${TAG}"
                    }
                    // docker.withRegistry('http://'+registry, registryCredentials) {
                    // }
                }
                }
              }
        stage ('Create POD') {
            when {expression {params.Workstation == 'Create POD'}}
            steps {
                script {
                kubernetesDeploy(configs: "pod.yml", kubeconfigId: "kubeconfig_deploy")
                }
            }
            }
            }
    post {
        always { 
            cleanWs()
        }
     }
}